<!DOCTYPE html>
<html>
<head>
  <title>BadFlandre's Search Engine</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <!-- Bootstrap CSS -->
  <link type="text/css" href="static/css/3.4.1-bootstrap.min.css" rel="stylesheet">
  <script src="static/js/3.7.1-jquery.min.js"></script>
  <link rel="alternate icon" href="static/favicon.ico" type="image/x-icon">
</head>
<body>
<div class="container">
  <div class="panel panel-primary">
    <div class="panel-heading">
      <div class="panel-title" style="font-size: 25px; text-align: center;">
        芙兰の检索引擎
      </div>
    </div>
    <div class="panel-body">
      <div class="alert alert-success" role="alert" style="display: flex; justify-content: center;">
        <form id="mks" method="get">
          <div class="form-group" style="display: flex; flex-direction: row; align-content: center; margin-top: 25px;">
            <div class="input-group" style="width: 500px; margin-right: 15px;">
              <div class="input-group-addon">
                检索内容：
              </div>
              <input id="key" class="form-control" type="text" name="songurl" value="" placeholder="请输入检索内容。">
            </div>
            <input type="submit" class="btn btn-primary" style="width: 80px" name="submit" value="搜索">
          </div>
          <br>
          <p style="font-size: 20px; text-align: center;">有事搜一搜，没事看一看。</p>
        </form>
      </div>
    </div>
  </div>
</div>
<div class="container">
  <div class="panel panel-primary">
    <div class="panel-heading">
      <div class="panel-title" id="ht" style="text-align:center; font-size: 20px; font-weight: 600;">
        念两句诗
      </div>
    </div>
    <div class="panel-body">
      <div id="res" class="alert alert-success" role="alert" style="display: flex; justify-content: center; flex-direction: column;">
        <p id="hitokoto">
          <div style="font-size: 22px; text-align: center; color: #000;" id="hitokoto_text">念两句诗···</div>
        </p>
      </div>
    </div>
  </div>
</div>
<script>
  $(document).ready(function () {
    /* 监听表单的 submit 事件 */
    $("#mks").submit(function (event) {
        /* 阻止表单的默认提交行为 */
        event.preventDefault();

        /*
        // 最后手动提交表单
        // 使用 this.submit() 可以触发原生的表单提交行为
        // this.submit();
        */

        let key = $('#key').val();

        $.getJSON('a?submit=' + encodeURIComponent(key), d => {
          /* console.log(d); */

          $('#ht').text("检索结果(" + d.data.length + "条)");

          if (d.errorMsg != undefined || d.errorMsg != null) {
			  $('#res').html("<span>错误信息: " + d.errorMsg + "</span>");
		  } else if (d.data.length == 0) {
			  $('#res').html("<span>无结果</span>");
		  } else {
			  let html = "";
			  for (let index = 0; index < d.data.length; index++) {
				  let item = d.data[index];
				  html += "<li><a href=\"http://" + item.url + "\">" + item.title + "</a></li>";
			  }
			  $('#res').html(html);
		  }
        });
    });
});
</script>
<script>
  fetch('https://v1.hitokoto.cn/?c=i')
    .then(response => response.json())
    .then(data => {
      let hitokoto = document.querySelector('#hitokoto_text');
      hitokoto.href = `https://hitokoto.cn/?uuid=${data.uuid}`;
      hitokoto.innerText = data.hitokoto;
    })
    .catch(console.error)
</script>
</body>
</html>